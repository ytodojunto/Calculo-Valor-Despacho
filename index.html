<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calculadora Pilotaje 2024</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { background-color: #f8f9fa; padding-top: 20px; padding-bottom: 60px; font-family: 'Segoe UI', sans-serif; }
        .card { border: none; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        .header-bg { background-color: #0d2e5c; color: white; padding: 15px; border-radius: 12px 12px 0 0; text-align: center; }
        .section-title { color: #0d2e5c; font-weight: 700; border-bottom: 2px solid #e9ecef; margin-bottom: 15px; padding-bottom: 5px; font-size: 1.1rem; }
        .result-box { background-color: #fff; border: 2px solid #0d2e5c; padding: 20px; border-radius: 10px; margin-top: 25px; }
        .total-final { font-size: 2rem; font-weight: 800; color: #0d2e5c; }
        .btn-calc { background-color: #b91c1c; color: white; width: 100%; padding: 15px; border: none; border-radius: 8px; font-weight: bold; font-size: 1.2rem; transition: background 0.3s; }
        .btn-calc:hover { background-color: #8a1212; }
        .badge-version { background-color: #ffc107; color: #000; padding: 4px 10px; border-radius: 4px; font-weight: bold; font-size: 0.8rem; display: inline-block; margin-top: 5px; }
    </style>
</head>
<body>

<div class="container" style="max-width: 650px;">
    <div class="card">
        <div class="header-bg">
            <h3 class="m-0 fw-bold">Calculadora Pilotaje</h3>
            <span class="badge-version">TARIFA ABRIL 2024</span>
        </div>
        <div class="card-body p-4">
            
            <h5 class="section-title">1. Datos del Buque (UF)</h5>
            
            <div class="mb-3 text-center">
                <div class="btn-group w-100" role="group">
                    <input type="radio" class="btn-check" name="modeUf" id="radioDim" checked onclick="toggleMode()">
                    <label class="btn btn-outline-primary" for="radioDim">Por Medidas</label>

                    <input type="radio" class="btn-check" name="modeUf" id="radioCoef" onclick="toggleMode()">
                    <label class="btn btn-outline-primary" for="radioCoef">Coeficiente Directo</label>
                </div>
            </div>

            <div id="panelDim" class="row g-2">
                <div class="col-4">
                    <label class="form-label small text-muted">Eslora</label>
                    <input type="number" id="eslora" class="form-control" placeholder="0.00" step="0.01">
                </div>
                <div class="col-4">
                    <label class="form-label small text-muted">Manga</label>
                    <input type="number" id="manga" class="form-control" placeholder="0.00" step="0.01">
                </div>
                <div class="col-4">
                    <label class="form-label small text-muted">Puntal</label>
                    <input type="number" id="puntal" class="form-control" placeholder="0.00" step="0.01">
                </div>
            </div>

            <div id="panelCoef" class="d-none">
                <div class="input-group">
                    <span class="input-group-text fw-bold">UF</span>
                    <input type="number" id="ufDirecto" class="form-control fw-bold" placeholder="Ej: 115">
                </div>
            </div>

            <div class="text-end mt-2">
                <small class="text-muted">UF Calculada: <strong id="dispUF" class="text-primary fs-5">0</strong> (Mín 65)</small>
            </div>

            <h5 class="section-title mt-4">2. Ruta y Distancia</h5>
            
            <div class="mb-3">
                <label class="form-label small fw-bold text-muted">Vía de Navegación:</label>
                <div class="btn-group w-100" role="group">
                    <input type="radio" class="btn-check" name="ruta" id="rutaMitre" checked onclick="calcDist()">
                    <label class="btn btn-outline-secondary" for="rutaMitre">Emilio Mitre</label>
                    
                    <input type="radio" class="btn-check" name="ruta" id="rutaMartin" onclick="calcDist()">
                    <label class="btn btn-outline-secondary" for="rutaMartin">Martín García</label>
                </div>
            </div>

            <div class="row g-2">
                <div class="col-12">
                    <label class="small text-muted fw-bold">Origen</label>
                    <select id="selOrigen" class="form-select fw-bold" onchange="calcDist()"></select>
                </div>
                <div class="col-12">
                    <label class="small text-muted fw-bold">Destino</label>
                    <select id="selDestino" class="form-select fw-bold" onchange="calcDist()"></select>
                </div>
            </div>

            <div class="alert alert-secondary mt-3 py-2 d-flex justify-content-between align-items-center">
                <span class="small fw-bold">Distancia a facturar:</span>
                <span class="fs-5 fw-bold text-dark"><span id="dispKm">0.0</span> km</span>
            </div>
            <div id="msgRuta" class="text-center text-danger small fw-bold"></div>

            <h5 class="section-title mt-4">3. Variables</h5>
            <div class="row g-2">
                <div class="col-6">
                    <label class="small text-muted fw-bold">Calado (Metros)</label>
                    <input type="number" id="calado" class="form-control" placeholder="Ej: 9.80" step="0.01" onkeyup="updatePies()">
                    <div class="small text-primary mt-1" id="dispPies">0.00 pies</div>
                </div>
                <div class="col-3">
                    <label class="small text-muted fw-bold">Prácticos</label>
                    <input type="number" id="practicos" class="form-control text-center fw-bold" value="1">
                </div>
                <div class="col-3">
                    <label class="small text-muted fw-bold">Demora</label>
                    <input type="number" id="demora" class="form-control text-center fw-bold" value="0">
                </div>
            </div>

            <div class="form-check mt-3 bg-light p-3 rounded border">
                <input class="form-check-input ms-1" type="checkbox" id="checkUru" style="transform: scale(1.3)">
                <label class="form-check-label fw-bold ms-3 pt-1" for="checkUru">
                    Adicional Puerto Uruguayo (+ USD 2.500)
                </label>
            </div>

            <div class="mt-4">
                <button type="button" class="btn-calc shadow" onclick="calcular()">CALCULAR PRECIO FINAL</button>
            </div>

            <div id="resultados" class="result-box d-none">
                <div class="d-flex justify-content-between mb-1">
                    <span>Fiscal (x $8):</span> <strong id="resFiscal">0.00</strong>
                </div>
                <div class="d-flex justify-content-between mb-1">
                    <span>Recorrido (x $12):</span> <strong id="resRecorrido">0.00</strong>
                </div>
                <hr class="my-2">
                <div class="d-flex justify-content-between mb-1 text-danger">
                    <span>Recargo Calado (<span id="resPct">0</span>%):</span> <strong id="resCalado">0.00</strong>
                </div>
                <div class="d-flex justify-content-between mb-1">
                    <span>Demora:</span> <strong id="resDemora">0.00</strong>
                </div>
                <div class="d-flex justify-content-between mb-1">
                    <span>Gastos Fijos:</span> <strong id="resGastos">0.00</strong>
                </div>
                <div class="d-flex justify-content-between mb-1">
                    <span>Adic. Uruguay:</span> <strong id="resUru">0.00</strong>
                </div>
                <hr>
                <div class="text-center">
                    <span class="text-muted text-uppercase small fw-bold">Total Estimado (USD)</span>
                    <div class="total-final" id="resTotal">0.00</div>
                </div>
            </div>

        </div>
    </div>
    <div class="text-center mt-3 text-muted small">Versión V11 - Tarifa Multipar 2024</div>
</div>

<script>
    // --- BASE DE DATOS DE PUERTOS (KM DEL RÍO) ---
    // Ajustado para que San Lorenzo (443) - Recalada (14) = 429km
    const puertos = [
        { km: 14, name: "ZEYA / Recalada (Ref Km 14)" },
        { km: 52, name: "Zona Común / La Plata (Km 52)" },
        { km: 60, name: "Escobar (Km 60)" },
        { km: 94, name: "Campana (Km 94)" },
        { km: 110, name: "Zárate (Km 110)" },
        { km: 123, name: "Las Palmas (Km 123)" },
        { km: 132, name: "Delta Dock (Km 132)" },
        { km: 171, name: "Km 171 / Brazo Largo" },
        { km: 178.5, name: "Del Guazú (Km 178.5)" },
        { km: 210, name: "Ibicuy (Km 210)" },
        { km: 273.5, name: "San Pedro (Km 273.5)" },
        { km: 325, name: "Ramallo (Km 325)" },
        { km: 330, name: "Bunge / Martin (Km 330)" },
        { km: 344, name: "San Nicolás (Km 344)" },
        { km: 362, name: "Villa Constitución (Km 362)" },
        { km: 395, name: "Gral. Lagos (Km 395)" },
        { km: 408, name: "V. Gdor. Gálvez (Km 408)" },
        { km: 412, name: "Rosario / Cargill (Km 412)" },
        { km: 420, name: "Rosario Norte (Km 420)" },
        { km: 443, name: "San Lorenzo (Km 443)" },
        { km: 448, name: "San Lorenzo Desemb. (Km 448)" },
        { km: 455, name: "San Martín (Km 455)" },
        { km: 460, name: "Timbúes (Km 460)" },
        { km: 535, name: "Diamante (Ref Km 535)" },
        { km: 583, name: "Santa Fe (Ref Km 583)" }
    ];

    // --- CARGA INICIAL ---
    window.onload = function() {
        const s1 = document.getElementById("selOrigen");
        const s2 = document.getElementById("selDestino");

        puertos.forEach(p => {
            let o1 = document.createElement("option");
            o1.value = p.km; o1.text = p.name;
            s1.appendChild(o1);
            
            let o2 = document.createElement("option");
            o2.value = p.km; o2.text = p.name;
            s2.appendChild(o2);
        });

        // Default
        s1.value = 443; // SL
        s2.value = 14;  // Recalada
        calcDist();
        toggleMode();
    };

    // --- LOGICA DE DISTANCIA ---
    function calcDist() {
        let k1 = parseFloat(document.getElementById("selOrigen").value);
        let k2 = parseFloat(document.getElementById("selDestino").value);
        let dist = Math.abs(k1 - k2);
        
        let esMartin = document.getElementById("rutaMartin").checked;
        let msg = document.getElementById("msgRuta");

        // Lógica: Si es Vía Martín García y atraviesa la zona del Delta (Entre Km 60 y Km 100 aprox)
        // Se suma la diferencia de recorrido (+35.6km)
        let cruzaDelta = (k1 < 60 || k2 < 60) && (k1 > 100 || k2 > 100);

        if(esMartin && cruzaDelta) {
            dist += 35.6; 
            msg.innerText = "Incluye +35.6 km por Vía Martín García";
        } else {
            msg.innerText = "";
        }

        document.getElementById("dispKm").innerText = dist.toFixed(1);
        return dist;
    }

    // --- LOGICA VISUAL ---
    function toggleMode() {
        if(document.getElementById("radioDim").checked) {
            document.getElementById("panelDim").classList.remove("d-none");
            document.getElementById("panelCoef").classList.add("d-none");
        } else {
            document.getElementById("panelDim").classList.add("d-none");
            document.getElementById("panelCoef").classList.remove("d-none");
        }
    }

    function updatePies() {
        let m = parseFloat(document.getElementById("calado").value) || 0;
        let ft = m * 3.28084;
        document.getElementById("dispPies").innerText = ft.toFixed(2) + " pies";
    }

    // --- CALCULO FINAL ---
    function calcular() {
        try {
            // 1. UF
            let uf = 0;
            if(document.getElementById("radioDim").checked) {
                let e = parseFloat(document.getElementById("eslora").value) || 0;
                let m = parseFloat(document.getElementById("manga").value) || 0;
                let p = parseFloat(document.getElementById("puntal").value) || 0;
                uf = Math.ceil((e*m*p)/800);
            } else {
                uf = Math.ceil(parseFloat(document.getElementById("ufDirecto").value) || 0);
            }
            if(uf < 65) uf = 65;
            document.getElementById("dispUF").innerText = uf;

            // 2. Variables
            let practicos = parseInt(document.getElementById("practicos").value) || 1;
            let demora = parseFloat(document.getElementById("demora").value) || 0;
            let caladoM = parseFloat(document.getElementById("calado").value) || 0;
            let esUru = document.getElementById("checkUru").checked;
            
            let km = calcDist();

            // 3. Costos Base (Tarifa 2024)
            let cFiscal = (8 * uf) * practicos;
            let cRecorrido = (12 * km) * practicos;
            let subtotal = cFiscal + cRecorrido;

            // 4. Calado
            let ft = caladoM * 3.28084;
            let pct = 0;
            if(ft > 28 && ft <= 30) pct = 0.075;
            else if(ft > 30 && ft <= 32) pct = 0.15;
            else if(ft > 32 && ft <= 34) pct = 0.225;
            else if(ft > 34) pct = 0.30;
            
            let cCalado = subtotal * pct;

            // 5. Extras
            let cDemora = demora * 150;
            // Gastos 2024: Traslado 2490 + Ordenanza 2490 = 4980
            let cGastos = 4980 * practicos;
            let cUru = esUru ? 2500 : 0;

            let total = subtotal + cCalado + cDemora + cGastos + cUru;

            // 6. Mostrar
            document.getElementById("resFiscal").innerText = cFiscal.toFixed(2);
            document.getElementById("resRecorrido").innerText = cRecorrido.toFixed(2);
            
            document.getElementById("resPct").innerText = (pct*100).toFixed(1);
            document.getElementById("resCalado").innerText = cCalado.toFixed(2);
            
            document.getElementById("resDemora").innerText = cDemora.toFixed(2);
            document.getElementById("resGastos").innerText = cGastos.toFixed(2);
            document.getElementById("resUru").innerText = cUru.toFixed(2);
            
            document.getElementById("resTotal").innerText = total.toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: 2});

            let box = document.getElementById("resultados");
            box.classList.remove("d-none");
            box.scrollIntoView({behavior: "smooth"});

        } catch(e) {
            alert("Error: Verifique los datos ingresados.");
        }
    }
</script>

</body>
</html>
