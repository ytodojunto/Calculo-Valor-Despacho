<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calculadora 2024 - FINAL</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { background-color: #f2f2f2; font-family: sans-serif; padding: 20px; }
        .card { border: none; border-radius: 10px; box-shadow: 0 5px 15px rgba(0,0,0,0.1); }
        .header-bg { background-color: #8B0000; color: white; padding: 15px; border-radius: 10px 10px 0 0; text-align: center; }
        .btn-calc { background-color: #8B0000; color: white; width: 100%; padding: 15px; border: none; border-radius: 5px; font-weight: bold; font-size: 1.2rem; margin-top: 20px; }
        .btn-calc:hover { background-color: #600000; }
        .result-box { background-color: white; border: 2px solid #8B0000; padding: 20px; border-radius: 5px; margin-top: 20px; }
        .total-gd { font-size: 2em; color: #8B0000; font-weight: bold; }
        .version-tag { background: #ffc107; color: black; padding: 2px 8px; border-radius: 4px; font-weight: bold; font-size: 0.8rem; }
    </style>
</head>
<body>

<div class="container" style="max-width: 600px;">
    <div class="card">
        <div class="header-bg">
            <h3 class="m-0">Tarifa Pilotaje</h3>
            <div class="version-tag mt-2">VIGENCIA ABRIL 2024</div>
        </div>
        <div class="card-body">
            
            <h6 class="text-danger fw-bold border-bottom pb-2">1. DATOS DEL BUQUE (UF)</h6>
            <div class="mb-3 text-center">
                <input type="radio" name="modo" id="rbMedidas" checked onclick="mostrarPanel('medidas')"> <label class="me-3 fw-bold">Por Medidas</label>
                <input type="radio" name="modo" id="rbDirecto" onclick="mostrarPanel('directo')"> <label class="fw-bold">UF Directo</label>
            </div>

            <div id="panelMedidas" class="row g-2">
                <div class="col-4">
                    <label>Eslora</label>
                    <input type="number" id="eslora" class="form-control" placeholder="0.00">
                </div>
                <div class="col-4">
                    <label>Manga</label>
                    <input type="number" id="manga" class="form-control" placeholder="0.00">
                </div>
                <div class="col-4">
                    <label>Puntal</label>
                    <input type="number" id="puntal" class="form-control" placeholder="0.00">
                </div>
            </div>

            <div id="panelDirecto" class="d-none">
                <label>Ingrese Coeficiente (UF)</label>
                <input type="number" id="ufDirecto" class="form-control fw-bold" placeholder="Ej: 115">
            </div>

            <h6 class="text-danger fw-bold border-bottom pb-2 mt-4">2. RECORRIDO</h6>
            <div class="mb-2">
                <input type="radio" name="ruta" id="rMitre" checked onclick="calcDist()"> <label class="me-3">Vía Mitre</label>
                <input type="radio" name="ruta" id="rMartin" onclick="calcDist()"> <label>Vía Martín García</label>
            </div>
            <div class="row g-2">
                <div class="col-12">
                    <select id="selOrigen" class="form-select fw-bold" onchange="calcDist()"></select>
                </div>
                <div class="col-12">
                    <select id="selDestino" class="form-select fw-bold" onchange="calcDist()"></select>
                </div>
            </div>
            <div class="mt-2 text-end">
                Distancia: <strong class="text-danger fs-5"><span id="verKm">0.0</span> KM</strong>
            </div>

            <h6 class="text-danger fw-bold border-bottom pb-2 mt-4">3. VARIABLES</h6>
            <div class="row g-2">
                <div class="col-6">
                    <label>Calado (m)</label>
                    <input type="number" id="calado" class="form-control" placeholder="9.80">
                </div>
                <div class="col-3">
                    <label>Prácticos</label>
                    <input type="number" id="practicos" class="form-control text-center" value="1">
                </div>
                <div class="col-3">
                    <label>Demora</label>
                    <input type="number" id="demora" class="form-control text-center" value="0">
                </div>
            </div>
            <div class="form-check mt-3 bg-light p-2 border">
                <input class="form-check-input ms-1" type="checkbox" id="checkUru">
                <label class="form-check-label fw-bold ms-2">Incluye Puerto Uruguayo</label>
            </div>

            <button class="btn-calc" onclick="calcularFinal()">CALCULAR TOTAL</button>

            <div id="resultados" class="result-box d-none">
                <div class="d-flex justify-content-between">
                    <span>Fiscal (x $8):</span> <strong id="outFiscal">0.00</strong>
                </div>
                <div class="d-flex justify-content-between">
                    <span>Recorrido (x $12):</span> <strong id="outRecorrido">0.00</strong>
                </div>
                <hr>
                <div class="d-flex justify-content-between text-danger">
                    <span>Calado (<span id="outPct">0</span>%):</span> <strong id="outCalado">0.00</strong>
                </div>
                <div class="d-flex justify-content-between">
                    <span>Demora:</span> <strong id="outDemora">0.00</strong>
                </div>
                <div class="d-flex justify-content-between">
                    <span>Gastos:</span> <strong id="outGastos">0.00</strong>
                </div>
                <div class="d-flex justify-content-between">
                    <span>Uruguay:</span> <strong id="outUru">0.00</strong>
                </div>
                <hr>
                <div class="text-center">
                    TOTAL ESTIMADO (USD)<br>
                    <span class="total-gd" id="outTotal">0.00</span>
                </div>
            </div>

        </div>
    </div>
</div>

<script>
    // LISTA DE PUERTOS
    var puertos = [
        {k:14, n:"ZEYA / Recalada (Ref Km 14)"},
        {k:52, n:"Zona Común / La Plata (Km 52)"},
        {k:60, n:"Escobar (Km 60)"},
        {k:94, n:"Campana (Km 94)"},
        {k:110, n:"Zárate (Km 110)"},
        {k:123, n:"Las Palmas (Km 123)"},
        {k:132, n:"Delta Dock (Km 132)"},
        {k:171, n:"Km 171 / Brazo Largo"},
        {k:178.5, n:"Del Guazú (Km 178.5)"},
        {k:210, n:"Ibicuy (Km 210)"},
        {k:273.5, n:"San Pedro (Km 273.5)"},
        {k:325, n:"Ramallo (Km 325)"},
        {k:330, n:"Bunge / Martin (Km 330)"},
        {k:344, n:"San Nicolás (Km 344)"},
        {k:362, n:"Villa Constitución (Km 362)"},
        {k:395, n:"Gral. Lagos (Km 395)"},
        {k:408, n:"V. Gdor. Gálvez (Km 408)"},
        {k:412, n:"Rosario / Cargill (Km 412)"},
        {k:420, n:"Rosario Norte (Km 420)"},
        {k:443, n:"San Lorenzo (Km 443)"},
        {k:448, n:"San Lorenzo Desemb. (Km 448)"},
        {k:455, n:"San Martín (Km 455)"},
        {k:460, n:"Timbúes (Km 460)"},
        {k:535, n:"Diamante (Ref Km 535)"},
        {k:583, n:"Santa Fe (Ref Km 583)"}
    ];

    // CARGAR LISTAS AL INICIO
    var s1 = document.getElementById("selOrigen");
    var s2 = document.getElementById("selDestino");

    for(var i=0; i<puertos.length; i++) {
        var opt = document.createElement("option");
        opt.value = puertos[i].k;
        opt.text = puertos[i].n;
        s1.appendChild(opt);
        
        var opt2 = document.createElement("option");
        opt2.value = puertos[i].k;
        opt2.text = puertos[i].n;
        s2.appendChild(opt2);
    }
    
    // VALORES POR DEFECTO
    s1.value = 443; // San Lorenzo
    s2.value = 14;  // Recalada
    calcDist(); // Calcular distancia inicial

    // FUNCIONES
    function mostrarPanel(tipo) {
        if(tipo == 'medidas') {
            document.getElementById('panelMedidas').classList.remove('d-none');
            document.getElementById('panelDirecto').classList.add('d-none');
        } else {
            document.getElementById('panelMedidas').classList.add('d-none');
            document.getElementById('panelDirecto').classList.remove('d-none');
        }
    }

    function calcDist() {
        var k1 = parseFloat(document.getElementById("selOrigen").value);
        var k2 = parseFloat(document.getElementById("selDestino").value);
        var dist = Math.abs(k1 - k2);
        
        var esMG = document.getElementById("rMartin").checked;
        // Si es Martin Garcia y cruza la zona critica
        if(esMG && (k1<60 || k2<60) && (k1>100 || k2>100)) {
            dist = dist + 35.6;
        }
        
        document.getElementById("verKm").innerText = dist.toFixed(1);
        return dist;
    }

    function calcularFinal() {
        // DATOS
        var cantP = parseInt(document.getElementById("practicos").value) || 1;
        var demo = parseFloat(document.getElementById("demora").value) || 0;
        var calM = parseFloat(document.getElementById("calado").value) || 0;
        var esUru = document.getElementById("checkUru").checked;
        var km = calcDist();

        // CALCULO UF
        var uf = 0;
        if(document.getElementById("rbMedidas").checked) {
            var e = parseFloat(document.getElementById("eslora").value) || 0;
            var m = parseFloat(document.getElementById("manga").value) || 0;
            var p = parseFloat(document.getElementById("puntal").value) || 0;
            uf = Math.ceil((e * m * p) / 800);
        } else {
            uf = Math.ceil(parseFloat(document.getElementById("ufDirecto").value) || 0);
        }
        if(uf < 65) uf = 65; // Minimo

        // COSTOS (TARIFA 2024)
        [cite_start]var basicoFiscal = (8 * uf) * cantP; [cite: 16]
        [cite_start]var basicoRec = (12 * km) * cantP; [cite: 18]
        var subtotal = basicoFiscal + basicoRec;

        // CALADO
        var calFt = calM * 3.28084;
        var pct = 0;
        if(calFt > 28 && calFt <= 30) pct = 0.075;
        if(calFt > 30 && calFt <= 32) pct = 0.15;
        if(calFt > 32 && calFt <= 34) pct = 0.225;
        if(calFt > 34) pct = 0.30;
        [cite_start]var costoCal = subtotal * pct; [cite: 26]

        // EXTRAS
        [cite_start]var costoDemo = demo * 150; [cite: 29]
        var costoGastos = (2490 + 2490) * cantP; [cite_start]// [cite: 81, 82]
        var costoUru = esUru ? [cite_start]2500 : 0; [cite: 83]

        var total = subtotal + costoCal + costoDemo + costoGastos + costoUru;

        // MOSTRAR
        document.getElementById("outFiscal").innerText = basicoFiscal.toFixed(2);
        document.getElementById("outRecorrido").innerText = basicoRec.toFixed(2);
        
        document.getElementById("outPct").innerText = (pct*100).toFixed(1);
        document.getElementById("outCalado").innerText = costoCal.toFixed(2);
        
        document.getElementById("outDemora").innerText = costoDemo.toFixed(2);
        document.getElementById("outGastos").innerText = costoGastos.toFixed(2);
        document.getElementById("outUru").innerText = costoUru.toFixed(2);
        
        document.getElementById("outTotal").innerText = total.toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: 2});

        document.getElementById("resultados").classList.remove("d-none");
        document.getElementById("resultados").scrollIntoView();
    }
</script>

</body>
</html>
