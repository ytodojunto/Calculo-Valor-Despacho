<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calculadora Pilotaje 2024 (V7)</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { background-color: #f8f9fa; padding-top: 15px; padding-bottom: 80px; font-family: sans-serif; }
        .card { border: none; box-shadow: 0 4px 12px rgba(0,0,0,0.1); border-radius: 12px; }
        /* Rojo Intenso Institucional 2024 */
        .header-bg { background: linear-gradient(135deg, #b91c1c 0%, #991b1b 100%); color: white; padding: 20px; border-radius: 12px 12px 0 0; }
        .section-title { color: #b91c1c; font-weight: 800; font-size: 0.9rem; text-transform: uppercase; border-bottom: 2px solid #e5e7eb; margin: 20px 0 10px 0; padding-bottom: 5px; }
        
        .result-container { background-color: #ffffff; border: 2px solid #e5e7eb; border-left: 5px solid #b91c1c; padding: 20px; border-radius: 8px; margin-top: 25px; }
        .total-price { font-size: 2.2rem; font-weight: 800; color: #b91c1c; display: block; line-height: 1.1; }
        
        .btn-action { background-color: #b91c1c; color: white; font-weight: bold; padding: 15px; border: none; border-radius: 8px; width: 100%; font-size: 1.1rem; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        .btn-action:active { background-color: #7f1d1d; transform: scale(0.98); }
        
        .form-control, .form-select { padding: 10px; border-radius: 8px; border: 1px solid #d1d5db; }
        .form-control:focus { border-color: #b91c1c; box-shadow: 0 0 0 3px rgba(185, 28, 28, 0.2); }
    </style>
</head>
<body>

<div class="container mb-5" style="max-width: 600px;">
    <div class="card">
        <div class="header-bg text-center">
            <h3 class="m-0 fw-bold">Tarifa Pilotaje</h3>
            [cite_start]<div style="font-size: 0.9rem; opacity: 0.9;">Vigencia Abril 2024 [cite: 3]</div>
        </div>
        <div class="card-body p-4">
            
            <div class="section-title">1. Coeficiente (UF)</div>
            
            <div class="btn-group w-100 mb-3" role="group">
                <input type="radio" class="btn-check" name="modoUf" id="optMedidas" checked onclick="setMode('medidas')">
                <label class="btn btn-outline-danger" for="optMedidas">Por Medidas</label>

                <input type="radio" class="btn-check" name="modoUf" id="optDirecto" onclick="setMode('directo')">
                <label class="btn btn-outline-danger" for="optDirecto">UF Directo</label>
            </div>

            <div id="panelMedidas">
                <div class="row g-2">
                    <div class="col-4">
                        <label class="small text-muted fw-bold">Eslora</label>
                        <input type="number" class="form-control" id="inEslora" placeholder="m">
                    </div>
                    <div class="col-4">
                        <label class="small text-muted fw-bold">Manga</label>
                        <input type="number" class="form-control" id="inManga" placeholder="m">
                    </div>
                    <div class="col-4">
                        <label class="small text-muted fw-bold">Puntal</label>
                        <input type="number" class="form-control" id="inPuntal" placeholder="m">
                    </div>
                </div>
            </div>

            <div id="panelDirecto" class="d-none">
                <div class="input-group">
                    <span class="input-group-text fw-bold">UF</span>
                    <input type="number" class="form-control fw-bold" id="inUfDirecto" placeholder="Ej: 115">
                </div>
            </div>

            <div class="text-end mt-2">
                [cite_start]<small class="text-secondary">Coeficiente: <strong class="fs-5 text-dark" id="displayUF">0</strong> (Mín 65 [cite: 36])</small>
            </div>

            <div class="section-title">2. Recorrido</div>

            <div class="btn-group w-100 btn-group-sm mb-3">
                <input type="radio" class="btn-check" name="ruta" id="rutaMitre" checked onclick="calcDist()">
                <label class="btn btn-outline-secondary" for="rutaMitre">Vía Mitre</label>
                
                <input type="radio" class="btn-check" name="ruta" id="rutaMartin" onclick="calcDist()">
                <label class="btn btn-outline-secondary" for="rutaMartin">Vía M. García</label>
            </div>

            <div class="row g-2">
                <div class="col-12">
                    <label class="small fw-bold text-muted">Origen</label>
                    <select class="form-select fw-bold" id="selOrigen" onchange="calcDist()"></select>
                </div>
                <div class="col-12">
                    <label class="small fw-bold text-muted">Destino</label>
                    <select class="form-select fw-bold" id="selDestino" onchange="calcDist()"></select>
                </div>
            </div>

            <div class="input-group mt-3">
                <span class="input-group-text bg-light fw-bold text-danger">Distancia</span>
                <input type="text" class="form-control text-end fw-bold text-danger fs-5" id="displayKm" readonly value="0.0">
                <span class="input-group-text bg-light">KM</span>
            </div>
            <div id="avisoRuta" class="text-center small mt-1 text-muted fst-italic"></div>

            <div class="section-title">3. Variables</div>
            
            <div class="row g-2">
                <div class="col-6">
                    <label class="small fw-bold">Calado (m)</label>
                    <input type="number" class="form-control" id="inCalado" placeholder="9.80" oninput="showPies()">
                    <div class="small text-primary mt-1 fw-bold" id="displayPies">0.00 pies</div>
                </div>
                <div class="col-3">
                    <label class="small fw-bold">Prácticos</label>
                    <input type="number" class="form-control text-center fw-bold" id="inPracticos" value="1">
                </div>
                <div class="col-3">
                    <label class="small fw-bold">Demora</label>
                    <input type="number" class="form-control text-center fw-bold" id="inDemora" value="0">
                </div>
            </div>

            <div class="form-check mt-3 p-2 border rounded bg-light">
                <input class="form-check-input ms-1" type="checkbox" id="checkUru">
                <label class="form-check-label fw-bold ms-2" for="checkUru">
                    [cite_start]Puerto Uruguayo (+USD 2.500 [cite: 83])
                </label>
            </div>

            <div class="mt-4">
                <button type="button" class="btn-action" onclick="calcularAhora()">CALCULAR TOTAL</button>
            </div>

            <div id="boxResultados" class="result-container d-none">
                <div class="text-end fst-italic text-muted small mb-2" id="fechaHora"></div>
                
                <div class="d-flex justify-content-between mb-1">
                    [cite_start]<span>Fiscal (<span id="outUF">0</span> UF x $8 [cite: 16]):</span>
                    <span class="fw-bold" id="outFiscal">0.00</span>
                </div>
                <div class="d-flex justify-content-between mb-2">
                    [cite_start]<span>Recorrido (<span id="outKM">0</span> km x $12 [cite: 18]):</span>
                    <span class="fw-bold" id="outRecorrido">0.00</span>
                </div>

                <div class="border-top border-bottom py-2 my-2 bg-light d-flex justify-content-between fw-bold">
                    <span>SUBTOTAL BÁSICO:</span>
                    <span id="outBasico">0.00</span>
                </div>

                <div class="d-flex justify-content-between text-danger mb-1">
                    [cite_start]<span>+ Calado (<span id="outPctCalado">0</span>% [cite: 26]):</span>
                    <span id="outMontoCalado">0.00</span>
                </div>
                <div class="d-flex justify-content-between mb-1">
                    [cite_start]<span>+ Demora (<span id="outHsDemora">0</span> hs [cite: 29]):</span>
                    <span id="outMontoDemora">0.00</span>
                </div>
                <div class="d-flex justify-content-between mb-1">
                    [cite_start]<span>+ Gastos Fijos (x<span id="outCantPrac">1</span>)[cite: 81, 82]:</span>
                    <span id="outGastos">0.00</span>
                </div>
                <div class="d-flex justify-content-between mb-1" id="rowUru">
                    <span>+ Adic. [cite_start]Uruguay[cite: 83]:</span>
                    <span id="outMontoUru">0.00</span>
                </div>

                <hr>
                <div class="text-center">
                    <span class="text-uppercase fw-bold text-secondary">Total a Facturar</span>
                    <span class="total-price">USD <span id="outTotal">0.00</span></span>
                </div>
            </div>

        </div>
    </div>
</div>

<script>
    // --- DATOS PUERTOS (KM REALES) ---
    const listadoPuertos = [
        {k:14, n:"ZEYA / Recalada (Ref Km 14)"},
        {k:52, n:"Zona Común / La Plata (Km 52)"},
        {k:60, n:"Escobar (Km 60)"},
        {k:94, n:"Campana (Km 94)"},
        {k:110, n:"Zárate (Km 110)"},
        {k:123, n:"Las Palmas (Km 123)"},
        {k:132, n:"Delta Dock (Km 132)"},
        {k:171, n:"Km 171 / Brazo Largo"},
        {k:178.5, n:"Del Guazú (Km 178.5)"},
        {k:210, n:"Ibicuy (Km 210)"},
        {k:273.5, n:"San Pedro (Km 273.5)"},
        {k:325, n:"Ramallo (Km 325)"},
        {k:330, n:"Bunge / Martin (Km 330)"},
        {k:344, n:"San Nicolás (Km 344)"},
        {k:362, n:"Villa Constitución (Km 362)"},
        {k:395, n:"Gral. Lagos (Km 395)"},
        {k:408, n:"V. Gdor. Gálvez (Km 408)"},
        {k:412, n:"Rosario / Cargill (Km 412)"},
        {k:420, n:"Rosario Norte (Km 420)"},
        {k:443, n:"San Lorenzo (Km 443)"},
        {k:448, n:"San Lorenzo Desemb. (Km 448)"},
        {k:455, n:"San Martín (Km 455)"},
        {k:460, n:"Timbúes (Km 460)"},
        {k:535, n:"Diamante (Ref Km 535)"},
        {k:583, n:"Santa Fe (Ref Km 583)"}
    ];

    // --- FUNCIONES ---
    function init() {
        const s1 = document.getElementById('selOrigen');
        const s2 = document.getElementById('selDestino');
        
        // Cargar puertos
        listadoPuertos.forEach(p => {
            let o1 = document.createElement('option');
            o1.value = p.k; o1.text = p.n;
            s1.appendChild(o1);
            
            let o2 = document.createElement('option');
            o2.value = p.k; o2.text = p.n;
            s2.appendChild(o2);
        });

        // Valores por defecto
        s1.value = 443; // SL
        s2.value = 14;  // Recalada
        calcDist();
    }

    function setMode(mode) {
        if(mode === 'medidas'){
            document.getElementById('panelMedidas').classList.remove('d-none');
            document.getElementById('panelDirecto').classList.add('d-none');
        } else {
            document.getElementById('panelMedidas').classList.add('d-none');
            document.getElementById('panelDirecto').classList.remove('d-none');
        }
    }

    function showPies() {
        let m = parseFloat(document.getElementById('inCalado').value) || 0;
        let ft = m * 3.28084;
        document.getElementById('displayPies').innerText = ft.toFixed(2) + " pies";
    }

    function calcDist() {
        let k1 = parseFloat(document.getElementById('selOrigen').value);
        let k2 = parseFloat(document.getElementById('selDestino').value);
        let dist = Math.abs(k1 - k2);
        
        // Logica Martin Garcia
        let isMG = document.getElementById('rutaMartin').checked;
        let cruceCritico = (k1 < 60 || k2 < 60) && (k1 > 100 || k2 > 100);

        if(isMG && cruceCritico) {
            dist += 35.6;
            document.getElementById('avisoRuta').innerText = "+35.6 km por Martín García";
        } else {
            document.getElementById('avisoRuta').innerText = "";
        }

        document.getElementById('displayKm').value = dist.toFixed(1);
    }

    function calcularAhora() {
        try {
            // 1. Obtener datos
            let practicos = parseInt(document.getElementById('inPracticos').value) || 1;
            let demora = parseFloat(document.getElementById('inDemora').value) || 0;
            let caladoM = parseFloat(document.getElementById('inCalado').value) || 0;
            let esUru = document.getElementById('checkUru').checked;
            
            calcDist(); // Asegurar distancia actualizada
            let km = parseFloat(document.getElementById('displayKm').value) || 0;

            // 2. Calcular UF
            let uf = 0;
            if(document.getElementById('optMedidas').checked) {
                let e = parseFloat(document.getElementById('inEslora').value) || 0;
                let m = parseFloat(document.getElementById('inManga').value) || 0;
                let p = parseFloat(document.getElementById('inPuntal').value) || 0;
                uf = Math.ceil((e * m * p) / 800);
            } else {
                uf = Math.ceil(parseFloat(document.getElementById('inUfDirecto').value) || 0);
            }
            if(uf < 65) uf = 65; [cite_start]// Minimo UF [cite: 36]
            document.getElementById('displayUF').innerText = uf;

            [cite_start]// 3. Costos [cite: 16, 18]
            let cFiscal = (8 * uf) * practicos;
            let cRecorrido = (12 * km) * practicos;
            let subtotal = cFiscal + cRecorrido;

            [cite_start]// 4. Calado [cite: 26]
            let caladoFt = caladoM * 3.28084;
            let pct = 0;
            if(caladoFt > 28) pct = 0.075;
            if(caladoFt > 30) pct = 0.15;
            if(caladoFt > 32) pct = 0.225;
            if(caladoFt > 34) pct = 0.30;
            let montoCalado = subtotal * pct;

            [cite_start]// 5. Extras [cite: 29, 81, 82, 83]
            let montoDemora = demora * 150;
            let gastos = (2490 + 2490) * practicos; // 4980 por practico
            let montoUru = esUru ? 2500 : 0;

            let total = subtotal + montoCalado + montoDemora + gastos + montoUru;

            // 6. Mostrar (Salida)
            document.getElementById('outUF').innerText = uf;
            document.getElementById('outFiscal').innerText = cFiscal.toFixed(2);
            document.getElementById('outKM').innerText = km.toFixed(1);
            document.getElementById('outRecorrido').innerText = cRecorrido.toFixed(2);
            document.getElementById('outBasico').innerText = subtotal.toFixed(2);
            
            document.getElementById('outPctCalado').innerText = (pct*100).toFixed(1);
            document.getElementById('outMontoCalado').innerText = montoCalado.toFixed(2);
            
            document.getElementById('outHsDemora').innerText = demora;
            document.getElementById('outMontoDemora').innerText = montoDemora.toFixed(2);
            
            document.getElementById('outCantPrac').innerText = practicos;
            document.getElementById('outGastos').innerText = gastos.toFixed(2);
            
            document.getElementById('outMontoUru').innerText = montoUru.toFixed(2);
            document.getElementById('outTotal').innerText = total.toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: 2});

            // Fecha
            let hoy = new Date();
            document.getElementById('fechaHora').innerText = hoy.toLocaleString();

            // Mostrar caja
            document.getElementById('boxResultados').classList.remove('d-none');
            document.getElementById('boxResultados').scrollIntoView({behavior: 'smooth'});

        } catch (error) {
            alert("Error al calcular: " + error.message);
        }
    }

    // Iniciar al cargar
    window.onload = init;

</script>
</body>
</html>
