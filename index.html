<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calculadora Visual 2024</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { background-color: #f4f7f6; padding: 20px; font-family: 'Segoe UI', sans-serif; }
        
        /* TARJETA PRINCIPAL */
        .main-card { border: none; border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); overflow: hidden; background: white; max-width: 700px; margin: 0 auto; }
        .header-bg { background: #b91c1c; color: white; padding: 20px; text-align: center; }
        
        /* BOTONES DE SELECCI칍N (ICONOS) */
        .mode-btn {
            border: 2px solid #e5e7eb;
            border-radius: 12px;
            padding: 15px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            background: white;
            color: #6b7280;
        }
        .mode-btn:hover { border-color: #b91c1c; background-color: #fef2f2; }
        
        /* ESTADO ACTIVO (ROJO) */
        .mode-btn.active {
            background-color: #b91c1c;
            border-color: #b91c1c;
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(185, 28, 28, 0.3);
        }
        
        .mode-icon { font-size: 2rem; margin-bottom: 5px; display: block; }
        
        /* FORMULARIOS */
        .input-group-text { background: #f3f4f6; font-weight: bold; border: 1px solid #ced4da; }
        .form-control:focus, .form-select:focus { border-color: #b91c1c; box-shadow: 0 0 0 3px rgba(185, 28, 28, 0.1); }
        
        /* BOTON CALCULAR */
        .btn-calc {
            background: #b91c1c; color: white; border: none;
            padding: 15px; width: 100%; border-radius: 10px;
            font-size: 1.2rem; font-weight: 800; letter-spacing: 1px;
            margin-top: 25px; transition: background 0.2s;
        }
        .btn-calc:hover { background: #991b1b; }

        /* RESULTADOS */
        .result-panel {
            background: #fff; border: 1px solid #e5e7eb;
            border-left: 6px solid #b91c1c;
            border-radius: 8px; padding: 20px;
            margin-top: 30px; box-shadow: 0 5px 20px rgba(0,0,0,0.05);
        }
        .final-price { font-size: 2.5rem; font-weight: 800; color: #b91c1c; line-height: 1; }
    </style>
</head>
<body>

<div class="main-card">
    <div class="header-bg">
        <h3 class="m-0 fw-bold">CALCULADORA PILOTAJE</h3>
        <span class="badge bg-warning text-dark mt-2">TARIFA ABRIL 2024</span>
    </div>

    <div class="p-4">
        
        <h6 class="text-danger fw-bold text-uppercase mb-3">1. 쮺칩mo calculamos el Buque?</h6>
        
        <div class="row g-3 mb-4">
            <div class="col-6">
                <div class="mode-btn active" id="btnMedidas" onclick="setMode('medidas')">
                    <span class="mode-icon">游뚹</span>
                    <div class="fw-bold">Dimensiones</div>
                    <small style="font-size: 0.75rem;">Eslora x Manga x Puntal</small>
                </div>
            </div>
            <div class="col-6">
                <div class="mode-btn" id="btnDirecto" onclick="setMode('directo')">
                    <span class="mode-icon">游댝</span>
                    <div class="fw-bold">Coeficiente (UF)</div>
                    <small style="font-size: 0.75rem;">Ingreso directo</small>
                </div>
            </div>
        </div>

        <div id="panelMedidas">
            <div class="row g-2">
                <div class="col-4">
                    <label class="small text-muted fw-bold">Eslora</label>
                    <input type="number" id="eslora" class="form-control text-center" placeholder="m">
                </div>
                <div class="col-4">
                    <label class="small text-muted fw-bold">Manga</label>
                    <input type="number" id="manga" class="form-control text-center" placeholder="m">
                </div>
                <div class="col-4">
                    <label class="small text-muted fw-bold">Puntal</label>
                    <input type="number" id="puntal" class="form-control text-center" placeholder="m">
                </div>
            </div>
        </div>

        <div id="panelDirecto" class="d-none">
            <div class="input-group input-group-lg">
                <span class="input-group-text bg-white text-danger">UF</span>
                <input type="number" id="ufDirecto" class="form-control fw-bold" placeholder="Ej: 115">
            </div>
            <div class="form-text text-center">Ingrese el n칰mero entero del Coeficiente Fiscal.</div>
        </div>

        <hr class="my-4">

        <h6 class="text-danger fw-bold text-uppercase mb-3">2. Viaje y Variables</h6>

        <div class="row g-2 mb-3">
            <div class="col-12">
                <div class="input-group">
                    <span class="input-group-text">Origen</span>
                    <select id="selOrigen" class="form-select fw-bold" onchange="calcDist()"></select>
                </div>
            </div>
            <div class="col-12">
                <div class="input-group">
                    <span class="input-group-text">Destino</span>
                    <select id="selDestino" class="form-select fw-bold" onchange="calcDist()"></select>
                </div>
            </div>
        </div>

        <div class="row align-items-center mb-3">
            <div class="col-7">
                <div class="form-check form-switch">
                    <input class="form-check-input" type="checkbox" id="checkMartinGarcia" onchange="calcDist()">
                    <label class="form-check-label small fw-bold" for="checkMartinGarcia">V칤a Mart칤n Garc칤a</label>
                </div>
            </div>
            <div class="col-5 text-end">
                <span class="badge bg-light text-dark border p-2">Dist: <strong id="lblKm" class="text-danger fs-6">0.0</strong> km</span>
            </div>
        </div>

        <div class="row g-2">
            <div class="col-4">
                <label class="small text-muted fw-bold">Calado (m)</label>
                <input type="number" id="calado" class="form-control text-center" placeholder="9.80">
            </div>
            <div class="col-4">
                <label class="small text-muted fw-bold">Pr치cticos</label>
                <input type="number" id="practicos" class="form-control text-center fw-bold" value="1">
            </div>
            <div class="col-4">
                <label class="small text-muted fw-bold">Demora (hs)</label>
                <input type="number" id="demora" class="form-control text-center" value="0">
            </div>
        </div>

        <div class="form-check mt-3 bg-light p-3 rounded border">
            <input class="form-check-input ms-1" type="checkbox" id="checkUru" style="transform: scale(1.2);">
            <label class="form-check-label fw-bold ms-2 pt-1" for="checkUru">Adicional Puerto Uruguayo</label>
        </div>

        <button class="btn-calc shadow" onclick="calcular()">CALCULAR PRECIO FINAL</button>

        <div id="resultados" class="result-panel d-none">
            <div class="row">
                <div class="col-md-6 border-end">
                    <small class="text-uppercase text-muted fw-bold">Detalle</small>
                    <div class="d-flex justify-content-between mt-2">
                        <span>Fiscal (<span id="rUF">0</span>):</span> <strong id="rFiscal">0.00</strong>
                    </div>
                    <div class="d-flex justify-content-between">
                        <span>Recorrido (<span id="rKM">0</span>):</span> <strong id="rRecorrido">0.00</strong>
                    </div>
                    <div class="d-flex justify-content-between text-danger">
                        <span>Calado (<span id="rPct">0</span>%):</span> <strong id="rCalado">0.00</strong>
                    </div>
                    <hr class="my-2">
                    <div class="d-flex justify-content-between">
                        <span>Gastos Fijos:</span> <strong id="rGastos">0.00</strong>
                    </div>
                    <div class="d-flex justify-content-between">
                        <span>Demora/Otros:</span> <strong id="rExtras">0.00</strong>
                    </div>
                </div>
                <div class="col-md-6 text-center d-flex flex-column justify-content-center mt-3 mt-md-0">
                    <span class="text-uppercase fw-bold text-secondary">Total Estimado</span>
                    <span class="final-price">USD <span id="rTotal">0.00</span></span>
                </div>
            </div>
        </div>

    </div>
</div>

<script>
    // 1. BASE DE DATOS
    var puertos = [
        {k:14, n:"ZEYA / Recalada (Ref Km 14)"},
        {k:52, n:"Zona Com칰n / La Plata (Km 52)"},
        {k:60, n:"Escobar (Km 60)"},
        {k:94, n:"Campana (Km 94)"},
        {k:110, n:"Z치rate (Km 110)"},
        {k:123, n:"Las Palmas (Km 123)"},
        {k:132, n:"Delta Dock (Km 132)"},
        {k:171, n:"Km 171 / Brazo Largo"},
        {k:178.5, n:"Del Guaz칰 (Km 178.5)"},
        {k:210, n:"Ibicuy (Km 210)"},
        {k:273.5, n:"San Pedro (Km 273.5)"},
        {k:325, n:"Ramallo (Km 325)"},
        {k:330, n:"Bunge / Martin (Km 330)"},
        {k:344, n:"San Nicol치s (Km 344)"},
        {k:362, n:"Villa Constituci칩n (Km 362)"},
        {k:395, n:"Gral. Lagos (Km 395)"},
        {k:408, n:"V. Gdor. G치lvez (Km 408)"},
        {k:412, n:"Rosario / Cargill (Km 412)"},
        {k:420, n:"Rosario Norte (Km 420)"},
        {k:443, n:"San Lorenzo (Km 443)"},
        {k:448, n:"San Lorenzo Desemb. (Km 448)"},
        {k:455, n:"San Mart칤n (Km 455)"},
        {k:460, n:"Timb칰es (Km 460)"},
        {k:535, n:"Diamante (Ref Km 535)"},
        {k:583, n:"Santa Fe (Ref Km 583)"}
    ];

    // 2. ESTADO GLOBAL
    var modoActual = 'medidas'; // 'medidas' o 'directo'

    // 3. INICIO
    window.onload = function() {
        var s1 = document.getElementById("selOrigen");
        var s2 = document.getElementById("selDestino");

        puertos.forEach(function(p) {
            var o1 = document.createElement("option");
            o1.value = p.k; o1.text = p.n;
            s1.appendChild(o1);
            
            var o2 = document.createElement("option");
            o2.value = p.k; o2.text = p.n;
            s2.appendChild(o2);
        });

        s1.value = 443; 
        s2.value = 14;
        calcDist();
    };

    // 4. FUNCIONES VISUALES
    window.setMode = function(modo) {
        modoActual = modo;
        
        // Manejo visual de botones
        if(modo === 'medidas') {
            document.getElementById('btnMedidas').classList.add('active');
            document.getElementById('btnDirecto').classList.remove('active');
            document.getElementById('panelMedidas').classList.remove('d-none');
            document.getElementById('panelDirecto').classList.add('d-none');
        } else {
            document.getElementById('btnMedidas').classList.remove('active');
            document.getElementById('btnDirecto').classList.add('active');
            document.getElementById('panelMedidas').classList.add('d-none');
            document.getElementById('panelDirecto').classList.remove('d-none');
            // Foco al input
            setTimeout(function(){ document.getElementById('ufDirecto').focus(); }, 100);
        }
    };

    window.calcDist = function() {
        var k1 = parseFloat(document.getElementById("selOrigen").value);
        var k2 = parseFloat(document.getElementById("selDestino").value);
        var dist = Math.abs(k1 - k2);
        
        var esMG = document.getElementById("checkMartinGarcia").checked;
        if(esMG && (k1<60 || k2<60) && (k1>100 || k2>100)) {
            dist += 35.6;
        }
        
        document.getElementById("lblKm").innerText = dist.toFixed(1);
        return dist;
    };

    [cite_start]// 5. CALCULO PRINCIPAL (TARIFA 2024) [cite: 1, 4, 16, 18, 26, 81, 82, 83]
    window.calcular = function() {
        try {
            // INPUTS
            var practicos = parseInt(document.getElementById("practicos").value) || 1;
            var demora = parseFloat(document.getElementById("demora").value) || 0;
            var caladoM = parseFloat(document.getElementById("calado").value) || 0;
            var esUru = document.getElementById("checkUru").checked;
            var km = calcDist();

            // LOGICA UF SEGUN MODO SELECCIONADO
            var uf = 0;
            if(modoActual === 'medidas') {
                var e = parseFloat(document.getElementById("eslora").value) || 0;
                var m = parseFloat(document.getElementById("manga").value) || 0;
                var p = parseFloat(document.getElementById("puntal").value) || 0;
                [cite_start]uf = Math.ceil((e * m * p) / 800); [cite: 15, 17]
            } else {
                // Modo Directo
                uf = Math.ceil(parseFloat(document.getElementById("ufDirecto").value) || 0);
            }
            
            // VALIDACION
            [cite_start]if(uf < 65) uf = 65; [cite: 36]

            // TARIFAS
            [cite_start]var costoFiscal = (8 * uf) * practicos; [cite: 16]
            [cite_start]var costoRecorrido = (12 * km) * practicos; [cite: 18]
            var subtotal = costoFiscal + costoRecorrido;

            [cite_start]// CALADO [cite: 26]
            var pies = caladoM * 3.28084;
            var pct = 0;
            if(pies > 28 && pies <= 30) pct = 0.075;
            else if(pies > 30 && pies <= 32) pct = 0.15;
            else if(pies > 32 && pies <= 34) pct = 0.225;
            else if(pies > 34) pct = 0.30;
            
            var montoCalado = subtotal * pct;

            [cite_start]// EXTRAS [cite: 29, 81, 82, 83]
            var montoDemora = demora * 150;
            var montoGastos = (2490 + 2490) * practicos; // Traslado + Ordenanza
            var montoUru = esUru ? 2500 : 0;

            var total = subtotal + montoCalado + montoDemora + montoGastos + montoUru;

            // MOSTRAR RESULTADOS
            document.getElementById("rUF").innerText = uf;
            document.getElementById("rKM").innerText = km.toFixed(1);
            
            document.getElementById("rFiscal").innerText = costoFiscal.toFixed(2);
            document.getElementById("rRecorrido").innerText = costoRecorrido.toFixed(2);
            
            document.getElementById("rPct").innerText = (pct*100).toFixed(1);
            document.getElementById("rCalado").innerText = montoCalado.toFixed(2);
            
            document.getElementById("rGastos").innerText = montoGastos.toFixed(2);
            document.getElementById("rExtras").innerText = (montoDemora + montoUru).toFixed(2);
            
            document.getElementById("rTotal").innerText = total.toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: 2});

            // Visualizar
            var panel = document.getElementById("resultados");
            panel.classList.remove("d-none");
            panel.scrollIntoView({ behavior: 'smooth' });

        } catch (e) {
            alert("Error: " + e.message);
        }
    };
</script>

</body>
</html>
